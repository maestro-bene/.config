#!/usr/bin/env fish

# Style for the header banner
gum style \
    --foreground 12 --border-foreground 12 --border double \
    --align center --width 60 --margin "1 0" --padding "1 0" \
    'â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  
â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•'

# Create a timestamped log file
set -l NOW (date +"%Y-%m-%d-%H-%M-%S")
echo -e "$NOW\n" >>/tmp/u-$NOW.txt

# Update tpm plugins and log output
gum spin --spinner globe --title " ðŸªŸ tpm plugins updating..." --show-output -- ~/.config/tmux/plugins/tpm/bin/update_plugins all >>/tmp/u-$NOW.txt
echo "Tpm plugins updated" >>/tmp/u-$NOW.txt
echo " âœ… ðŸªŸ tpm plugins updated"

# Update fisher plugins and log output
gum spin --spinner globe --title " ðŸ  fisher plugins updating..." --show-output -- fisher update >>/tmp/u-$NOW.txt
echo "Fisher plugins updated" >>/tmp/u-$NOW.txt
echo " âœ… ðŸ  fisher plugins updated"

# Sync lazy.nvim and log output
gum spin --spinner globe --title " ðŸ’¤ lazy.nvim syncing..." -- nvim --headless "+Lazy! sync" +qa
echo "Lazy synced" >>/tmp/u-$NOW.txt
echo " âœ… ðŸ’¤ lazy.nvim synced"

# Update mason.nvim and log output
gum spin --spinner globe --title " ðŸ§° mason.nvim updating" -- nvim --headless "+MasonUpdate" +qa
echo "Mason updated" >>/tmp/u-$NOW.txt
echo " âœ… ðŸ§° mason.nvim updated"

# Stopping yabai and log output
gum spin --spinner globe --title " ðŸ›‘ yabai stopping..." -- yabai --stop-service >>/tmp/u-$NOW.txt
echo "Stopped yabai" >>/tmp/u-$NOW.txt
echo " âœ… ðŸ›‘ yabai stopped"

# Call the external brew script and log its output
echo " ðŸ» brew script to update and upgrade :"
bash ~/.config/bin/b
echo " âœ… ðŸ» brew script finished"

# Restart yabai and log output
gum spin --spinner globe --title " ðŸŸ¢ yabai starting..." -- yabai --start-service >>/tmp/u-$NOW.txt
echo "Restarted yabai" >>/tmp/u-$NOW.txt
echo " âœ… ðŸŸ¢ yabai started"

# Indicate logging location
echo " âœ… ðŸ§¾ logged to /tmp/u-$NOW.txt"
$EDITOR /tmp/u-$NOW.txt
