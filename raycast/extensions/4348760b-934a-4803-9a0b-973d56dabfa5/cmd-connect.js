"use strict";var f=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var v=(t,n)=>{for(var r in n)f(t,r,{get:n[r],enumerable:!0})},L=(t,n,r,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of T(n))!W.call(t,a)&&a!==r&&f(t,a,{get:()=>n[a],enumerable:!(i=C(n,a))||i.enumerable});return t};var I=t=>L(f({},"__esModule",{value:!0}),t);var F={};v(F,{default:()=>P});module.exports=I(F);var m=require("react"),e=require("@raycast/api");var p=require("child_process");var l=Object.assign({},process.env,{PATH:"/usr/local/bin:/usr/bin:/opt/homebrew/bin"});function d(){return new Promise((t,n)=>{(0,p.exec)("sesh list --json",{env:l},(r,i,a)=>{if(r||a)return n("Please upgrade to the latest version of the sesh CLI");let s=JSON.parse(i);return t(s??[])})})}function g(t){return new Promise((n,r)=>{(0,p.exec)(`sesh connect --switch ${t}`,{env:l},(i,a,s)=>i||s?(console.error("error ",i),console.error("stderr ",s),r(i?.message??s)):n())})}function w(){return new Promise(t=>{(0,p.exec)("tmux ls",{env:l},(n,r,i)=>t(!(n||i)))})}var x=require("@raycast/api"),h=require("child_process");function A(){let{openWithApp:t}=(0,x.getPreferenceValues)();return new Promise((n,r)=>{(0,h.exec)(`open -a ${t.name}`,{env:l},(i,a,s)=>i||s?r(i?.message??s):n())})}var c=require("react/jsx-runtime");function y(t){return t.Src==="tmux"?{source:e.Icon.Bolt,tintColor:t.Attached>=1?e.Color.Green:e.Color.Blue,tooltip:t.Attached>=1?"Attached":"Detached"}:{source:e.Icon.Folder,tintColor:e.Color.SecondaryText}}function k(t){if(t!==0)return String(Number.isInteger(t)?t:t.toFixed(2))}function P(){let[t,n]=(0,m.useState)([]),[r,i]=(0,m.useState)([]),[a,s]=(0,m.useState)(!0);async function b(){try{let o=await d();n(o.filter(u=>u.Src==="tmux")),i(o.filter(u=>u.Src==="zoxide"))}catch(o){await(0,e.showToast)({style:e.Toast.Style.Failure,title:"Couldn't get sessions",message:typeof o=="string"?o:"Unknown reason"})}finally{s(!1)}}(0,m.useEffect)(()=>{(async()=>{if(!await w()){await(0,e.showToast)({style:e.Toast.Style.Failure,title:"tmux isn't running",message:"Please start tmux before using this command."}),s(!1);return}await b()})()},[]);async function S(o){try{s(!0),await g(o),await A(),await(0,e.closeMainWindow)(),await(0,e.clearSearchBar)()}catch(u){await(0,e.showToast)({style:e.Toast.Style.Failure,title:"Couldn't connect to session",message:typeof u=="string"?u:"Unknown reason"})}finally{s(!1)}}return(0,c.jsxs)(e.List,{isLoading:a,children:[(0,c.jsx)(e.List.Section,{title:"tmux",children:t.map((o,u)=>(0,c.jsx)(e.List.Item,{title:o.Name,icon:y(o),accessories:[{icon:e.Icon.AppWindow,text:String(o.Windows),tooltip:o.Windows===1?"Window":"Windows"}],actions:(0,c.jsx)(e.ActionPanel,{children:(0,c.jsx)(e.Action,{title:"Connect to Session",onAction:()=>S(o.Path)})})},u))}),(0,c.jsx)(e.List.Section,{title:"zoxide",children:r.map((o,u)=>(0,c.jsx)(e.List.Item,{title:o.Name,icon:y(o),accessories:[{text:k(o.Score),icon:e.Icon.Racket,tooltip:"Score"}],actions:(0,c.jsx)(e.ActionPanel,{children:(0,c.jsx)(e.Action,{title:"Connect to Session",onAction:()=>S(o.Path)})})},u))})]})}
